<?php
/* 
การทำความสะอาดสิ่งที่ปลั๊กอินทิ้งไว้เมื่อผู้ใช้งานถอนการติดตั้งปลั๊กอินเป็นส่วนสำคัญของการพัฒนาปลั๊กอินอย่างมืออาชีพ การเขียนขั้นตอนการถอนการติดตั้งใช้งานง่าย แต่ช่วยให้ผู้ใช้มั่นใจว่าสามารถใช้ปลั๊กอินโดยไม่ต้องกังวลว่าจะมีข้อมูลที่ไม่ต้องการหลงเหลืออยู่

การถอนการติดตั้งมีความจำเป็นเพราะเมื่อผู้ใช้ติดตั้งแอปบนมือถือและตัดสินใจที่จะไม่ใช้งานแล้ว ก็จะลบหรือ "ถอนการติดตั้ง" โดยไม่ต้องการให้แอปทิ้งการตั้งค่าหรือข้อมูลอื่นๆ ที่ไม่จำเป็นไว้ ปลั๊กอินใน WordPress ก็เช่นเดียวกัน ผู้ใช้ควรมั่นใจได้ว่าเว็บไซต์ของพวกเขาไม่มีข้อมูลที่ไม่จำเป็นหลงเหลืออยู่จากปลั๊กอินที่เคยใช้หรือทดสอบ

สิ่งสำคัญที่สุดในการพัฒนาปลั๊กอินคือการจัดการและลบสิ่งที่ไม่จำเป็นออกไป เมื่อปลั๊กอินถูกถอนการติดตั้ง ให้ตรวจสอบว่าได้ลบออปชันหรือข้อมูลอื่นๆ ที่ปลั๊กอินเพิ่มเข้ามาแล้ว อย่างไรก็ตาม บางครั้งเราอาจต้องเก็บเนื้อหาที่ผู้ใช้สร้างขึ้น เช่น Custom Post Type หรือตารางฐานข้อมูลที่กำหนดเอง ในกรณีเหล่านี้ ควรมีการตั้งค่าให้ผู้ใช้เลือกได้ว่าต้องการลบข้อมูลเหล่านั้นเมื่อถอนการติดตั้งหรือไม่

หลักการทั่วไปคือต้องเคารพเนื้อหาของผู้ใช้ ถ้าไม่แน่ใจ ให้ขออนุญาตผู้ใช้ก่อนลบข้อมูลที่พวกเขาอาจต้องการเก็บไว้

WordPress มีวิธีการถอนการติดตั้งปลั๊กอินสองวิธี ได้แก่ การใช้ไฟล์ uninstall.php และ Uninstall Hook

อธิบาย code:

*/
1. ไฟล์ `uninstall.php`:
```php
<?php
// ตรวจสอบว่าถูกเรียกจากหน้าถอนการติดตั้งปลั๊กอินของ WordPress จริงๆ
if (!defined('WP_UNINSTALL_PLUGIN')) {
    die;
}

// ลบออปชันของปลั๊กอิน
delete_option('plugin_option_name');

// ลบ Custom Post Type และ Taxonomy
unregister_post_type('custom_post_type');
unregister_taxonomy('custom_taxonomy');

// ลบตารางฐานข้อมูลที่กำหนดเอง
global $wpdb;
$wpdb->query("DROP TABLE IF EXISTS {$wpdb->prefix}custom_table");
```

คำอธิบาย:
- สร้างไฟล์ `uninstall.php` ในไดเรกทอรีหลักของปลั๊กอิน
- ตรวจสอบว่าไฟล์ถูกเรียกจากหน้าถอนการติดตั้งปลั๊กอินของ WordPress จริงๆ ด้วยคำสั่ง `if (!defined('WP_UNINSTALL_PLUGIN')) { die; }`
- เขียนโค้ดสำหรับลบออปชัน, Custom Post Type, Taxonomy และตารางฐานข้อมูลที่กำหนดเองของปลั๊กอินตามต้องการ

2. Uninstall Hook:
```php
function plugin_uninstall() {
    // ลบออปชันของปลั๊กอิน
    delete_option('plugin_option_name');

    // ลบ Custom Post Type และ Taxonomy
    unregister_post_type('custom_post_type');
    unregister_taxonomy('custom_taxonomy');

    // ลบตารางฐานข้อมูลที่กำหนดเอง
    global $wpdb;
    $wpdb->query("DROP TABLE IF EXISTS {$wpdb->prefix}custom_table");
}
register_uninstall_hook(__FILE__, 'plugin_uninstall');
```

คำอธิบาย:
- สร้างฟังก์ชันสำหรับจัดการการถอนการติดตั้งปลั๊กอิน เช่น `plugin_uninstall()`
- เขียนโค้ดสำหรับลบออปชัน, Custom Post Type, Taxonomy และตารางฐานข้อมูลที่กำหนดเองของปลั๊กอินภายในฟังก์ชัน
- ใช้ฟังก์ชัน `register_uninstall_hook()` เพื่อลงทะเบียน Uninstall Hook โดยระบุตำแหน่งไฟล์ปลั๊กอินและชื่อฟังก์ชันที่ต้องการเรียกใช้

ทั้งสองวิธีนี้ช่วยให้เราสามารถจัดการและลบข้อมูลที่ไม่จำเป็นออกไปเมื่อผู้ใช้ถอนการติดตั้งปลั๊กอิน ทำให้เว็บไซต์สะอาดและไม่มีข้อมูลที่ไม่ต้องการหลงเหลืออยู่